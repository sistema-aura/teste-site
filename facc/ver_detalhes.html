<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Fac√ß√£o ‚Äî Sistema AURA</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="icon" href="../Aurinha.png">
<link rel="stylesheet" href="../style.css">

<style>
a{ text-decoration:none !important; }

.section{ margin-bottom:2rem; }

.card{
  background:rgba(40,20,60,.45);
  border:1px solid rgba(160,120,255,.3);
  border-radius:22px;
  padding:2rem;
  backdrop-filter:blur(14px);
}

.header{
  display:flex;
  gap:20px;
  align-items:center;
}

.avatar{
  width:120px;
  height:120px;
  border-radius:20px;
  background:linear-gradient(135deg,#7c3aed,#9333ea);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:2rem;
  font-weight:900;
  color:white;
  overflow:hidden;
}

.avatar img{
  width:100%;
  height:100%;
  object-fit:cover;
}

.title h1{
  margin:0;
  color:#e9d5ff;
}

.title span{
  opacity:.8;
}

.roles{
  display:flex;
  gap:20px;
  margin-top:15px;
}

.role{
  background:rgba(124,58,237,.25);
  padding:14px;
  border-radius:14px;
  min-width:160px;
}

.role b{
  display:block;
  margin-bottom:6px;
  color:#e9d5ff;
}

.members{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
  gap:14px;
}

.member{
  background:rgba(124,58,237,.2);
  border-radius:14px;
  padding:10px;
  display:flex;
  gap:10px;
  align-items:center;
}

.member img{
  width:42px;
  height:42px;
  border-radius:50%;
  object-fit:cover;
}

.photos{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
}

.photos img{
  width:130px;
  height:130px;
  border-radius:18px;
  object-fit:cover;
  box-shadow:0 0 15px rgba(124,58,237,.4);
}

.actions{
  margin-top:20px;
  display:flex;
  gap:12px;
}

.btn{
  padding:.6rem 1.3rem;
  border-radius:14px;
  border:none;
  cursor:pointer;
  background:rgba(124,58,237,.3);
  color:white;
  font-weight:700;
}

.btn-main{
  background:linear-gradient(135deg,#7c3aed,#9333ea);
}
</style>
</head>

<body>

<div class="sidebar">
  <h2 class="logo">SISTEMA AURA</h2>
    <ul>
      <li><a href="../dashboard.html" class="navlink active"><span class="icon">üè†</span><span class="label">Dashboard</span></a></li>
      <li><a href="../facc/ver.html" class="navlink"><span class="icon">‚öîÔ∏è</span><span class="label">Fac√ß√µes</span></a></li>

  </div>

<div class="main-content">
<div class="page-container">

<div id="content"></div>

</div>
</div>

<script type="module">
import { initializeApp,getApps } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
import { getFirestore,doc,getDoc,collection,getDocs } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";
import { firebaseConfig } from "../firebaseConfig.js";
import { logAction } from "../utils/logger.js";


const id = new URLSearchParams(location.search).get("id");
if(!id) location.href="ver.html";

const app = getApps().length ? getApps()[0] : initializeApp(firebaseConfig);
const db = getFirestore(app);

const snap = await getDoc(doc(db,"facc",id));
if(!snap.exists()) location.href="ver.html";

const facc = snap.data();

// pessoas
const peopleSnap = await getDocs(collection(db,"people"));
const people = {};
peopleSnap.forEach(p => people[p.id] = p.data());

function name(id){ return people[id]?.name || "-"; }
function photo(id){ return people[id]?.photo || ""; }

document.getElementById("content").innerHTML = `
<div class="card">

  <div class="header">
    <div class="avatar" style="background:${facc.cor || '#7c3aed'}">
      ${facc.faccFoto ? `<img src="${facc.faccFoto}">` : (facc.sigla || facc.nome).slice(0,3)}
    </div>

    <div class="title">
      <h1>${facc.nome}</h1>
      <span>${facc.sigla || ""}</span>
    </div>
  </div>

  <div class="section">
    <h3>üëë Lideran√ßa</h3>
    <div class="roles">
      <div class="role"><b>01</b>${name(facc.hierarquia?.o1)}</div>
      <div class="role"><b>02</b>${name(facc.hierarquia?.o2)}</div>
      <div class="role"><b>03</b>${name(facc.hierarquia?.o3)}</div>
    </div>
  </div>

  <div class="section">
    <h3>üë• Membros</h3>
    <div class="members">
      ${(facc.hierarquia?.membros || []).map(id => `
        <div class="member">
          <img src="${photo(id)}">
          <span>${name(id)}</span>
        </div>
      `).join("")}
    </div>
  </div>

  <div class="section">
    <h3>üì¶ Produtos</h3>
    <div class="members">
      ${(facc.produtos || []).map(p => `<div class="member">${p}</div>`).join("")}
    </div>
  </div>

  <div class="section">
    <h3>üè† Base</h3>
    <p><b>Nome:</b> ${facc.base?.nome || "-"}</p>
    <p><b>Local:</b> ${facc.base?.local || "-"}</p>
    <p>${facc.base?.notas || ""}</p>
  </div>

  <div class="section">
    <h3>üì∏ Fotos Base</h3>
    <div class="photos">
      ${(facc.baseFotos || []).map(p => `<img src="${p}">`).join("")}
    </div>
  </div>

  <div class="actions">
    <a href="editar.html?id=${id}" class="btn btn-main">‚úèÔ∏è Editar</a>
    <a href="ver.html" class="btn">‚¨ÖÔ∏è Voltar</a>
  </div>

</div>
`;
</script>

</body>
</html>
